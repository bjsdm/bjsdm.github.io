---
layout: post
title: é‡æ‹¾çº¿ç¨‹â€”â€”å¼‚å¸¸å¤„ç†ï¼ˆ1ï¼‰
author: ä¸è¿‘è§†çš„çŒ«
date: 2022-04-24
categories: blog
tags: []
description: é‡æ‹¾çº¿ç¨‹â€”â€”å¼‚å¸¸å¤„ç†ï¼ˆ1ï¼‰
---

å…³äºçº¿ç¨‹çš„å¼‚å¸¸ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸€ä¸ªå°æ —å­ğŸŒ°ï¼š

```
fun main(args: Array<String>) {
    println("-------1---ä¸»çº¿ç¨‹å¼€å§‹æ‰§è¡Œ")
    try{
        Thread{
            println("-------2---å­çº¿ç¨‹å¼€å§‹æ‰§è¡Œ")
            throw Exception("error!!!")
            println("-------3---å­çº¿ç¨‹å¼‚å¸¸åæ‰§è¡Œ")
        }.start()
    }catch (e: Exception){
        println("-------4--æˆ‘æ•è·äº†å¼‚å¸¸")
    }

    println("-------4---ä¸»çº¿ç¨‹å¼€å¯å­çº¿ç¨‹åæ‰§è¡Œ")
    Thread.sleep(1000)
    println("-------5---ä¸»çº¿ç¨‹ sleep åæ‰§è¡Œ")
}
```

æ‰§è¡Œç»“æœï¼š

<img src="https://img-blog.csdnimg.cn/45b467d18694442c93dcf4466f7c0873.png" width = "600" >

å¯ä»¥åˆæ­¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š

- çº¿ç¨‹å‘ç”Ÿå¼‚å¸¸åï¼Œåç»­ä»£ç ä¸ä¼šæ‰§è¡Œ
- ä¸€ä¸ªçº¿ç¨‹å‘ç”Ÿå¼‚å¸¸ï¼Œä¸ä¼šå½±å“åˆ°å…¶å®ƒçº¿ç¨‹çš„æ‰§è¡Œ
- æ— æ³•ç®€å•çš„é€šè¿‡ try catch çº¿ç¨‹æ¥æ•è·çº¿ç¨‹çš„å¼‚å¸¸

è™½ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ try catch ä»£ç å—æ¥æ•è·å¼‚å¸¸ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸å¤ªå¯èƒ½å¯¹æ‰€æœ‰çš„ä»£ç å—è¿›è¡Œ try catch æ“ä½œï¼Œè€Œä¸”ï¼Œåœ¨å›¢é˜Ÿåä½œä¸­ï¼Œä¹Ÿå¾ˆéš¾è¦æ±‚æ‰€æœ‰äººéƒ½èƒ½å¤ŸæŒ‰éœ€æ•è·å¼‚å¸¸ï¼Œæ‰€æœ‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ•è·å¼‚å¸¸æœ‰å“ªå‡ ç§æ–¹å¼ï¼Œç„¶åæŒ‰éœ€åœ°é‡‡å–ç›¸åº”åœ°è§£å†³æ–¹æ¡ˆã€‚

## setUncaughtExceptionHandler

åœ¨åˆ›å»ºå¼‚å¸¸çš„æ—¶å€™ï¼Œè®¾ç½® `UncaughtExceptionHandler`ï¼Œç­‰åˆ°è¯¥çº¿ç¨‹å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨è¯¥ `UncaughtExceptionHandler` çš„ `uncaughtException` æ–¹æ³•ï¼š

```
    val thread = Thread {
        throw Exception("æˆ‘æ˜¯æµ‹è¯•å¼‚å¸¸")
    }
    thread.setUncaughtExceptionHandler { thread, throwable ->
        println("å‘ç”Ÿå¼‚å¸¸çš„çº¿ç¨‹åå­—${thread.name}, å¼‚å¸¸ï¼š${throwable.message}")
    }
    thread.start()
```

è¾“å‡ºç»“æœï¼š


<img src="https://img-blog.csdnimg.cn/c583c71f0f444788b3ed1b06662a8255.png" width = "600" >

```
å‘ç”Ÿå¼‚å¸¸çš„çº¿ç¨‹åå­—Thread-0, å¼‚å¸¸ï¼šæˆ‘æ˜¯æµ‹è¯•å¼‚å¸¸
```

è¯¥æ–¹å¼é€‚åˆäºå¯¹å•ä¸ªçº¿ç¨‹è¿›è¡Œæ§åˆ¶ï¼Œè‹¥è¦å¯¹çº¿ç¨‹ç»„è¿›è¡Œæ§åˆ¶çš„æ—¶å€™ï¼Œå°±éœ€è¦ä½¿ç”¨åˆ° `ThreadGroup`ã€‚

## ThreadGroup
ä½¿ç”¨æ­¥éª¤åŸºæœ¬å¦‚ä¸‹ï¼š

- åˆ›å»º `ThreadGroup` çš„ç»§æ‰¿ç±»ï¼Œå¹¶é‡å†™ `uncaughtException` çš„æ–¹æ³•
- åœ¨åç»­åˆ›å»ºçº¿ç¨‹çš„æ—¶å€™ï¼Œä¼ å…¥ `ThreadGroup` çš„å®ä¾‹ï¼Œè¡¨ç¤ºç»™çº¿ç¨‹ä¸ºè¯¥çº¿ç¨‹ç»„
- åç»­çº¿ç¨‹å‘ç”Ÿå¼‚å¸¸ï¼Œå°±ä¼šå›è°ƒåˆ°çš„ `ThreadGroup` çš„  `uncaughtException` æ–¹æ³•ä¸­

å…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```
    val threadGroup = object : ThreadGroup("çº¿ç¨‹ç»„1") {
        override fun uncaughtException(t: Thread, e: Throwable) {
            super.uncaughtException(t, e)
            println("å‘ç”Ÿå¼‚å¸¸çš„çº¿ç¨‹ç»„ï¼š${name} çº¿ç¨‹åå­—${t.name}, å¼‚å¸¸ï¼š${e.message}")
        }
    }
    val thread = Thread (threadGroup){
        throw Exception("æˆ‘æ˜¯æµ‹è¯•å¼‚å¸¸")
    }
    thread.start()
```

è¿è¡Œç»“æœï¼š

<img src="https://img-blog.csdnimg.cn/e6df89ef93134f7c86084aeaaeb66d28.png" width = "600" >

æ­¤æ—¶å¯ä»¥çœ‹å‡ºï¼Œè¯¥çº¿ç¨‹æ˜¯å·²ç»æŠ›å‡ºäº†å¼‚å¸¸ï¼Œç„¶åè¢«çº¿ç¨‹ç»„è¿›è¡Œæ•è·ï¼Œç„¶åè¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªè·Ÿ `setUncaughtExceptionHandler` æ˜¯ä¸å¤ªä¸€æ ·çš„ï¼Œ`setUncaughtExceptionHandler` æ˜¯ç›´æ¥å¯¹çº¿ç¨‹è¿›è¡Œæ•è·å¤„ç†äº†ï¼Œä¸ä¼šå†å‘ä¸Šå±‚è¿›è¡ŒæŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥ï¼Œå½“ `setUncaughtExceptionHandler`  å’Œ `ThreadGroup` é…åˆä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„ä¸‹è¿™ä¸ªç‰¹ç‚¹ã€‚
åœ¨è¿™é‡Œï¼Œæˆ‘ç»™ç¤ºä¾‹æ¥æ–¹ä¾¿å¤§å®¶ç†è§£ï¼Œå¦‚ä½•æ­£ç¡®å¤„ç† `setUncaughtExceptionHandler` å’Œ `ThreadGroup` çš„äº¤äº’ã€‚

```
    val threadGroup = object : ThreadGroup("çº¿ç¨‹ç»„1") {
        override fun uncaughtException(t: Thread, e: Throwable) {
            super.uncaughtException(t, e)
            println("å‘ç”Ÿå¼‚å¸¸çš„çº¿ç¨‹ç»„ï¼š${name} çº¿ç¨‹åå­—${t.name}, å¼‚å¸¸ï¼š${e.message}")
        }
    }
    val thread = Thread (threadGroup){
        throw Exception("æˆ‘æ˜¯æµ‹è¯•å¼‚å¸¸")
    }
    val defaultUncaughtExceptionHandler = thread.uncaughtExceptionHandler
    thread.setUncaughtExceptionHandler { thread, throwable ->
        if (throwable.message!!.contains("æµ‹è¯•")){
            println("å‘ç”Ÿå¼‚å¸¸çš„çº¿ç¨‹åå­—${thread.name}, å¼‚å¸¸ï¼š${throwable.message}")
        }else{
            defaultUncaughtExceptionHandler.uncaughtException(thread, throwable)
        }
    }
    thread.start()
```

é‡ç‚¹é€»è¾‘ï¼š

- å…ˆä¿å­˜ Thread é»˜è®¤çš„ `uncaughtExceptionHandler` ï¼Œå†è®¾ç½® `setUncaughtExceptionHandler`
- å½“çº¿ç¨‹å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™ï¼Œä¾æ®æƒ…å†µåˆ†åˆ«å¤„ç†ï¼š
	- ä¸å‘ä¸ŠæŠ›å¼‚å¸¸ï¼Œå°±æ— éœ€é¢å¤–ä»£ç 
	- å‘ä¸ŠæŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™éœ€è¦è°ƒç”¨`defaultUncaughtExceptionHandler.uncaughtException(thread, throwable)`

ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å…·ä½“çš„è¿è¡Œç»“æœï¼š

`throw Exception("æˆ‘æ˜¯æµ‹è¯•å¼‚å¸¸")` çš„æƒ…å†µï¼š

<img src="https://img-blog.csdnimg.cn/b2387e7650334a21a31438041e2ecc3f.png" width = "600" >

`throw Exception("æˆ‘æ˜¯å¼‚å¸¸")` çš„æƒ…å†µï¼š

<img src="https://img-blog.csdnimg.cn/e2bd5606edb540549769e8e5dcb931ef.png" width = "600" >

å†™åˆ°è¿™é‡Œï¼Œå¯èƒ½æœ‰äººå°±æœ‰ç–‘é—®äº†ï¼Œä½¿ç”¨ `ThreadGroup` ä¹Ÿå¤ªéº»çƒ¦äº†å§ï¼Œæ¯æ¬¡åˆ›å»ºçº¿ç¨‹éƒ½éœ€è¦ä¼ å…¥ `ThreadGroup` ï¼Œæœ‰æ²¡æœ‰ä¸€ç§æ–¹å¼ï¼Œç›´æ¥ç»™å…¨éƒ¨çº¿ç¨‹ç›´æ¥è®¾ç½®å¼‚å¸¸æ•è·ã€‚

è¿™å½“ç„¶ä¹Ÿæ˜¯æœ‰çš„ï¼Œ`setDefaultUncaughtExceptionHandler` å°±æ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚

## setDefaultUncaughtExceptionHandler
åœ¨æœ€å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šè¿‡ `setUncaughtExceptionHandler` ç»™å•ç‹¬çº¿ç¨‹è®¾ç½®å¼‚å¸¸æ•è·ï¼Œè€Œå…¶å®ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªé»˜è®¤çš„ `DefaultUncaughtExceptionHandler`ï¼Œæˆ‘ä»¬é‡æ–°è®¾ç½®é»˜è®¤çš„`DefaultUncaughtExceptionHandler` å°±å¯ä»¥ç»Ÿä¸€æ•è·çº¿ç¨‹ä¸­çš„å¼‚å¸¸äº†ã€‚

åŸºæœ¬æ“ä½œå¦‚ä¸‹ï¼š

```
    Thread.setDefaultUncaughtExceptionHandler{ thread, throwable ->
        println("å‘ç”Ÿå¼‚å¸¸çš„çº¿ç¨‹åå­—${thread.name}, å¼‚å¸¸ï¼š${throwable.message}")
    }
    
    val thread = Thread {
        throw Exception("æˆ‘æ˜¯æµ‹è¯•å¼‚å¸¸")
    }
    thread.start()
```

è¾“å‡ºç»“æœï¼š

<img src="https://img-blog.csdnimg.cn/6838b9fef7c94133a60bc2c0e8db65b6.png" width = "600" >

è¿™ä¸ªçœ‹èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªè¦ç‰¹åˆ«æ³¨æ„çš„ç‚¹ã€‚

ç¬¬ä¸€ç‚¹ï¼šå‡å¦‚ä½ æ˜¯ Android å¼€å‘è€…çš„è¯ï¼Œä½ æœ‰å¯èƒ½ä¼šé€šè¿‡è¿™ç§æ–¹å¼å»æ•è· Android å…¨å±€å¼‚å¸¸ï¼Œç„¶åè¿›è¡Œæ—¥å¿—å†™å…¥ï¼Œç„¶åæ€æ­»è¿›ç¨‹ï¼Œé‡æ–°å¯åŠ¨ Appã€‚

ä½†æ˜¯ï¼Œé€šè¿‡æˆ‘ä»¬çš„æµ‹è¯•å‘ç°ï¼Œå…¶å®ƒå­çº¿ç¨‹å‘ç”Ÿå¼‚å¸¸ä¹Ÿä¼šè¿›å…¥è¿™ä¸ªå¼‚å¸¸æ•è·ï¼Œè¿™æ—¶å°±è¦åˆ¤æ–­å¥½æ˜¯ä¸æ˜¯ä¸»çº¿ç¨‹å‘ç”Ÿå¼‚å¸¸çš„ï¼Œæ€»ä¸èƒ½å› ä¸ºå­çº¿ç¨‹å‘ç”Ÿå¼‚å¸¸å°±æŠŠæ•´ä¸ª App é‡å¯äº†å§ï¼Œæ²¡åˆ¤æ–­å¥½ï¼Œé‚£å°±æ˜¯å¦¥å¦¥åœ°è´Ÿä¼˜åŒ–äº†ã€‚ğŸ˜‚

ç¬¬äºŒç‚¹ï¼š`setDefaultUncaughtExceptionHandler` å’Œ `setUncaughtExceptionHandler` å…±åŒä½¿ç”¨æ˜¯æœ‰å¯èƒ½äº§ç”Ÿå†²çªçš„ï¼Œå°±åƒ `setUncaughtExceptionHandler` å’Œ `ThreadGroup` å…±åŒä½¿ç”¨é‚£æ ·ï¼Œæ‰€ä»¥ï¼Œå¿…è¦æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è§£å†³è¿™ç§å†²çªã€‚

ç”±äºå¤„ç†é€»è¾‘è·Ÿ  `setUncaughtExceptionHandler` å’Œ `ThreadGroup` å…¼å®¹é€»è¾‘å·®ä¸å¤šï¼Œæ‰€ä»¥è¿™é‡Œä»…æä¾›ç¤ºä¾‹ï¼Œå°±ä¸èµ˜è¿°äº†ã€‚

```
    val newUncaughtExceptionHandler = Thread.UncaughtExceptionHandler { t, e ->
        println("å…¨å±€æ•è·ï¼šå‘ç”Ÿå¼‚å¸¸çš„çº¿ç¨‹åå­—${t.name}, å¼‚å¸¸ï¼š${e.message}")
    }
    Thread.setDefaultUncaughtExceptionHandler(newUncaughtExceptionHandler)
    val thread = Thread {
        throw Exception("æˆ‘æ˜¯æµ‹è¯•å¼‚å¸¸")
    }
    thread.setUncaughtExceptionHandler { thread, throwable ->
        if (throwable.message!!.contains("æµ‹è¯•")){
            println("å­çº¿ç¨‹æ•è·ï¼šå‘ç”Ÿå¼‚å¸¸çš„çº¿ç¨‹åå­—${thread.name}, å¼‚å¸¸ï¼š${throwable.message}")
        }else{
            newUncaughtExceptionHandler.uncaughtException(thread, throwable)
        }
    }
    thread.start()
```

æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œè§£å†³ä¸‹ `DefaultUncaughtExceptionHandler`ã€`newUncaughtExceptionHandler`
ã€`setUncaughtExceptionHandler` å’Œ `ThreadGroup` å…±åŒå­˜åœ¨æ—¶çš„å¼‚å¸¸å¤„ç†ï¼Œäº†è§£ä¸‹å¦‚ä½•å±‚å±‚æŠŠå¼‚å¸¸ä¸ŠæŠ¥ä¸Šå»ã€‚

ä»¥ä¸Šçš„å¼‚å¸¸æ•è·éƒ½æ˜¯åŸºäº `Thread` çš„ï¼Œä½†æ˜¯ï¼Œç”±äº `Thread` æ²¡æœ‰è¿”å›å€¼ï¼Œæˆ‘ä»¬æœ‰æ—¶ä¼šç”¨åˆ° `FetureTask`ï¼Œé‚£ä¸‹é¢æˆ‘ä»¬å°±æ¥äº†è§£ä¸‹ï¼Œæœ‰æ²¡æœ‰å…¶å®ƒæ–¹å¼æ•è· `FetureTask` çš„å¼‚å¸¸ã€‚


## FetureTask çš„å¼‚å¸¸æ•è·

é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆå†™ä¸‹ç¤ºä¾‹ä»£ç æ¥è®© `FetureTask` æŠ›å‡ºå¼‚å¸¸ï¼š

```
    val futureTask = FutureTask {
        println("futureTask æ­£åœ¨æ‰§è¡Œ")
        throw Exception("æˆ‘æ˜¯æµ‹è¯•å¼‚å¸¸")
        return@FutureTask "1"
    }
    Thread(futureTask).start()
```

è¿è¡Œç»“æœï¼š

<img src="https://img-blog.csdnimg.cn/c87255faad0f45f8b0dcf688e8a70eb7.png" width = "600" >

<img src="https://img-blog.csdnimg.cn/20210329222955824.png" width = "120" >

è¯´å¥½çš„å¼‚å¸¸æ€ä¹ˆä¸è§äº†ï¼Ÿï¼Ÿï¼Ÿ

æ€ä¹ˆè¢«åƒäº†ï¼Ÿï¼Ÿï¼Ÿï¼ˆå¥½å§ï¼Œå…ˆç»™è‡ªå·±åŸ‹ä¸ªå‘ï¼Œæœ‰ç©ºè¡¥å……ä¸‹ FutureTask æ˜¯å¦‚ä½•åƒæ‰å¼‚å¸¸çš„ï¼‰

æˆ‘ä»¬å°è¯•ä¸‹è°ƒç”¨ FetureTask çš„ `get()` æ–¹æ³•ï¼š

```
    val futureTask = FutureTask {
        println("futureTask æ­£åœ¨æ‰§è¡Œ")
        throw Exception("æˆ‘æ˜¯æµ‹è¯•å¼‚å¸¸")
        return@FutureTask "1"
    }
    Thread(futureTask).start()

    futureTask.get()
```

è¿è¡Œç»“æœï¼š

<img src="https://img-blog.csdnimg.cn/e49439c8bee4479bbe9891458c4d00db.png" width = "600" >

<img src="https://img-blog.csdnimg.cn/20210326215055356.jpg" width = "150" >

å¼‚å¸¸ç»ˆäºå‡ºæ¥äº†ï¼

æ‰€ä»¥ï¼Œå¯¹äº FutureTask çš„å¼‚å¸¸æ“ä½œï¼Œé™¤äº†ä»¥ä¸Šæ“ä½œï¼Œè¿˜å¤šäº†ä¸€ç§æ–¹å¼æ¥è¿›è¡Œæ•è·å¼‚å¸¸ï¼š

```
    try {
        futureTask.get()
    }catch (e: Exception){
        println("å·²æ•è·å¼‚å¸¸ï¼š${e.message}")
    }
```

ä¸ºä»€ä¹ˆè¯´æ˜¯é™¤äº†ä»¥ä¸Šæ“ä½œï¼Ÿæ˜¯å› ä¸º FutureTask å…¶å®åªæ˜¯ä¸€ä¸ª Runnable æ¥å£çš„å®ç°ç±»ï¼Œå…·ä½“çš„çº¿ç¨‹å¼€å¯è¿˜æ˜¯äº¤ç»™ Threadã€‚

## Executors ä¸ setUncaughtExceptionHandlerã€ThreadGroup

ç»ˆäºåˆ°çº¿ç¨‹æ± äº†ï¼ï¼ï¼

å…¶å®ï¼ŒExecutors å¹¶æ²¡æœ‰ setUncaughtExceptionHandler æ–¹æ³•ï¼Œæˆ‘è¿™é‡Œæƒ³è¡¨è¿°çš„æ˜¯ï¼š

- Thread å¯ä»¥é€šè¿‡ setUncaughtExceptionHandler å’Œ ThreadGroup æ¥è¿›è¡Œå¼‚å¸¸æ•è·
- Executors è¦æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ä¹Ÿæ˜¯è¦åˆ›å»ºçº¿ç¨‹çš„ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºçº¿ç¨‹çš„æ—¶å€™ï¼Œå¯ä»¥è®¾ç½®setUncaughtExceptionHandler å’Œ ThreadGroup æ¥æ•è·å¼‚å¸¸ã€‚

åŸºæœ¬ç¤ºä¾‹å¦‚ä¸‹ï¼šï¼ˆç”±äºé€»è¾‘éƒ½æ˜¯å¤§åŒå°å¼‚ï¼Œå°±ä¸è¿‡å¤šè¯´æ˜ï¼‰

```
    val executorsService = Executors.newSingleThreadExecutor(object : ThreadFactory {
        override fun newThread(r: Runnable?): Thread {
            val thread = Thread(r)
            thread.setUncaughtExceptionHandler(object : Thread.UncaughtExceptionHandler {
                override fun uncaughtException(t: Thread, e: Throwable) {
                    println("å‘ç”Ÿå¼‚å¸¸çš„çº¿ç¨‹åå­—ï¼š${t.name}, å¼‚å¸¸ï¼š${e.message}")
                }
            })
            return thread
        }
    })
    executorsService.execute{
        throw Exception("æµ‹è¯•å¼‚å¸¸")
    }
```

è¾“å‡ºç»“æœï¼š


<img src="https://img-blog.csdnimg.cn/2124471856af4eccb46c7dba9b6311da.png" width = "600" >

ä¸è¿‡è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæ˜¯è°ƒç”¨ execute å»æäº¤ Runnable çš„ï¼Œä½†æ˜¯ï¼Œå‡å¦‚ä½ ä½¿ç”¨çš„æ˜¯ submit å»æäº¤ Runnable çš„è¯ï¼Œå¼‚å¸¸ä¹Ÿæ˜¯ä¼šè¢«åƒæ‰çš„ï¼ŒåŸç†å…¶å®å°±æ˜¯è·Ÿ FutureTask åƒæ‰å¼‚å¸¸çš„åŸå› ä¸€æ ·ï¼Œæ‰€ä»¥ï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œå¯ä»¥é€šè¿‡ try catch `get()` å»æ•è·å¼‚å¸¸:

```
    try {
        future.get()
    }catch (e: Exception){
        println("å·²æ•è·å¼‚å¸¸ï¼š${e.message}")
    }
```

## ThreadPoolExecutor çš„ afterExecute

è¿™ç§æ–¹å¼å…¶å®å¹¶ä¸æ˜¯æ•è·å¼‚å¸¸ï¼Œè€Œæ˜¯å¯¹å¼‚å¸¸è¿›è¡Œç›‘å¬ã€‚

å…·ä½“çš„åŸç†ä¸ºï¼ŒThreadPoolExecutor åœ¨æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨ `runWorker(Worker w)`ï¼Œè€Œ runWorker å¤§è‡´ä»£ç é€»è¾‘ï¼š

```
    final void runWorker(Worker w) {
        ...
        Runnable task = w.firstTask;
        ...
        while (task != null || (task = getTask()) != null) {
                ...
            try {
                ...
                Throwable thrown = null;
                try {
                    task.run();
                } catch (RuntimeException x) {
                    thrown = x;
                    throw x;
                } catch (Error x) {
                    thrown = x;
                    throw x;
                } catch (Throwable x) {
                    thrown = x;
                    throw new Error(x);
                } finally {
                    afterExecute(task, thrown);
                }
            } finally {
                    ...
            }
        }
        ...
    }
```

å…¶å®ï¼Œå°±æ˜¯å¯¹äº `run()` è¿›è¡Œ try catch æ“ä½œï¼Œç„¶åæŠŠå¼‚å¸¸å­˜å‚¨åˆ° thrown ä¸­ï¼Œæœ€ååœ¨ finally ä¸­æ‰§è¡Œ `afterExecute(task, thrown)`ã€‚

æ‰€ä»¥ï¼Œè¿™ç§æ–¹å¼å¹¶ä¸èƒ½å»æ•è·å¼‚å¸¸ï¼Œä½†æ˜¯ï¼Œå½“å‘ç”Ÿå¼‚å¸¸åï¼Œå¯ä»¥åœ¨ afterExecute ä¸­è·å–å¾—åˆ°å¼‚å¸¸ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œè‡ªå®šä¹‰å¤„ç†ã€‚

å…·ä½“çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```
    val threadPoolExecutor = object : ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS,
        LinkedBlockingQueue()) {
        override fun afterExecute(r: Runnable?, t: Throwable?) {
            super.afterExecute(r, t)
            println("å¼‚å¸¸ï¼š${t?.message}")
        }
    }
    threadPoolExecutor.execute {
        throw Exception("æµ‹è¯•å¼‚å¸¸")
    }
```

è¿è¡Œç»“æœï¼š


<img src="https://img-blog.csdnimg.cn/c186748625eb47e3a1c3221b22484fe0.png" width = "600" >































